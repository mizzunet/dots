#!/bin/bash
# playwithmpv - script to copy Firefox's current page URL by Vimium-c and play the URL with mpv

# FOCUS=$(swaymsg -t get_tree | jq -r '..|try select(.focused == true)' | jq ."app_id")
SPEED=2.3
FORMAT='139+133'
TIME="0.8"
MPV_ARGS="--config-dir=/home/missu/.config/mpv --script=/etc/mpv/scripts/mpris.so --pause --speed=$SPEED --save-position-on-quit --hwdec=auto --gpu-context=wayland --ytdl-format=$FORMAT --ao=pipewire"
# MPV_ARGS="--config-dir=/home/missu/.config/mpv --pause --speed=$SPEED --ytdl-format=$FORMAT"

# if [[ $FOCUS == '"firefox"' || $FOCUS == '"chromium"' ]]; then
    #wtype yy
    #sleep $TIME
    URL=$(wl-paste)
    # URL=$1
    if [[ $URL == https://* || $URL == http://*  ]]; then
        notify-send -u low 'Video will be played on mpv' -t 3000
        mpv $URL $MPV_ARGS || notify-send -u low 'Failed to recognize file format' -t 1000
    else
        notify-send 'No URL copied' -t 1000 -u low
    fi
# else
    # notify-send -u low 'Browser is not in focus' -t 1000
# fi
